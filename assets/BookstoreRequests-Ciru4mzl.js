import{v as Q,r as c,j as e,P as Oe,d as E,a1 as es,I as q,g as m,$ as ss,a as ye,h as as,q as ee,l as se,c as B,o as ae,a8 as ts,a9 as is,e as y,p as te,s as ie,i as h,t as re,n as _,m as we}from"./index-zZ0VZZ4p.js";import{T as rs,a as ns,b as ne,c as le}from"./tabs-BhBb3kdP.js";import{T as ls,C as Ce}from"./textarea-FeWkwKSv.js";import{C as D,a as L,b as V,c as J,d as I}from"./card-OND3B57R.js";import{S as ce,a as oe,b as de,c as me,d as M,D as Pe,e as Ee,f as ze,g as Re,h as Ae}from"./dialog-CO3Lc6Ku.js";import{B as K}from"./badge-CucsVBSM.js";import{P as xe}from"./package-CJdp4T86.js";import{T as F,P as Se}from"./trash-2-BdXGZdJo.js";import{E as ke}from"./eye-BSG9EsMj.js";import{H as Be}from"./history-DHKQCMmI.js";import"./index-crZK1vcL.js";import"./index-DPxdIXPI.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=Q("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=Q("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=Q("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=Q("StickyNote",[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]]),ms=["Bukz Las Lomas","Bukz Viva Envigado","Bukz Museo","Bukz Cedi","Bukz Administrativo","Bukz Bogota 109"];var xs="Separator",Te="horizontal",hs=["horizontal","vertical"],De=c.forwardRef((t,s)=>{const{decorative:l,orientation:u=Te,...x}=t,b=us(u)?u:Te,v=l?{role:"none"}:{"aria-orientation":b==="vertical"?b:void 0,role:"separator"};return e.jsx(Oe.div,{"data-orientation":b,...v,...x,ref:s})});De.displayName=xs;function us(t){return hs.includes(t)}var Le=De;const he=c.forwardRef(({className:t,orientation:s="horizontal",decorative:l=!0,...u},x)=>e.jsx(Le,{ref:x,decorative:l,orientation:s,className:E("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...u}));he.displayName=Le.displayName;const js=({products:t,cart:s,selectedBranch:l,setSelectedBranch:u,searchQuery:x,setSearchQuery:b,orderNote:g,setOrderNote:v,updateCart:a,handleSubmitOrder:p,isSubmitting:N,branches:w})=>e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs(D,{children:[e.jsxs(L,{children:[e.jsx(V,{children:"Realizar Pedido"}),e.jsx(J,{children:"Selecciona los productos que necesitas para tu sede"})]}),e.jsxs(I,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Sede Solicitante"}),e.jsxs(ce,{value:l,onValueChange:u,children:[e.jsx(oe,{children:e.jsx(de,{placeholder:"Selecciona tu sede..."})}),e.jsx(me,{children:w.map(i=>e.jsx(M,{value:i,children:i},i))})]})]}),e.jsx(he,{}),e.jsxs("div",{className:"relative",children:[e.jsx(es,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(q,{placeholder:"Buscar producto...",value:x,onChange:i=>b(i.target.value),className:"pl-9"})]}),e.jsx("div",{className:"grid gap-3 md:gap-4 grid-cols-1 sm:grid-cols-2",children:t.filter(i=>i.isVisible).filter(i=>{if(!x.trim())return!0;const j=x.toLowerCase();return i.name.toLowerCase().includes(j)||i.code&&i.code.toLowerCase().includes(j)||i.category&&i.category.toLowerCase().includes(j)}).map(i=>{var C;const j=((C=s.find(z=>z.id===i.id))==null?void 0:C.quantity)||0;return e.jsxs("div",{className:"flex flex-col gap-2 p-4 border rounded-xl bg-card hover:border-primary/50 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:"font-medium line-clamp-2 min-h-[2.5rem]",children:i.name}),e.jsx(xe,{className:"h-4 w-4 text-muted-foreground shrink-0"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-auto pt-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:i.category}),i.code&&e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:["Ref: ",i.code]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-muted/50 rounded-lg p-1",children:[e.jsx(m,{variant:"ghost",size:"icon",className:"h-6 w-6 rounded-md hover:bg-background",onClick:()=>a(i,j-1),disabled:j===0,children:"-"}),e.jsx("span",{className:"w-8 text-center font-medium text-sm",children:j}),e.jsx(m,{variant:"ghost",size:"icon",className:"h-6 w-6 rounded-md hover:bg-background",onClick:()=>a(i,j+1),children:"+"})]})]})]},i.id)})})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx("div",{className:"sticky top-20 space-y-4",children:e.jsxs(D,{className:"border-primary/20 shadow-md",children:[e.jsx(L,{className:"bg-primary/5 pb-4",children:e.jsxs(V,{className:"flex items-center gap-2 text-lg",children:[e.jsx(ds,{className:"h-5 w-5 text-primary"}),"Resumen del Pedido"]})}),e.jsxs(I,{className:"pt-6 space-y-4",children:[s.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(xe,{className:"h-12 w-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Tu carrito está vacío"})]}):e.jsxs("div",{className:"space-y-3",children:[s.map(i=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"truncate flex-1 pr-2",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs(K,{variant:"outline",children:["x",i.quantity]}),e.jsx(m,{variant:"ghost",size:"icon",className:"h-5 w-5 text-muted-foreground hover:text-destructive",onClick:()=>a(i,0),children:e.jsx(F,{className:"h-3 w-3"})})]})]},i.id)),e.jsx(he,{className:"my-2"}),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"Total Ítems"}),e.jsx("span",{children:s.reduce((i,j)=>i+j.quantity,0)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(qe,{className:"h-4 w-4 text-muted-foreground"}),"Nota (opcional)"]}),e.jsx(ls,{placeholder:"Agrega una nota o comentario a tu pedido...",value:g,onChange:i=>v(i.target.value),rows:3,className:"resize-none"})]}),e.jsx(m,{className:"w-full mt-4",size:"lg",disabled:s.length===0||!l||N,onClick:p,children:N?"Enviando...":e.jsxs(e.Fragment,{children:[e.jsx(os,{className:"h-4 w-4 mr-2"})," Enviar Solicitud"]})})]})]})})})]}),ue=c.forwardRef(({className:t,...s},l)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:l,className:E("w-full caption-bottom text-sm",t),...s})}));ue.displayName="Table";const je=c.forwardRef(({className:t,...s},l)=>e.jsx("thead",{ref:l,className:E("[&_tr]:border-b",t),...s}));je.displayName="TableHeader";const ge=c.forwardRef(({className:t,...s},l)=>e.jsx("tbody",{ref:l,className:E("[&_tr:last-child]:border-0",t),...s}));ge.displayName="TableBody";const gs=c.forwardRef(({className:t,...s},l)=>e.jsx("tfoot",{ref:l,className:E("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...s}));gs.displayName="TableFooter";const G=c.forwardRef(({className:t,...s},l)=>e.jsx("tr",{ref:l,className:E("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",t),...s}));G.displayName="TableRow";const T=c.forwardRef(({className:t,...s},l)=>e.jsx("th",{ref:l,className:E("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...s}));T.displayName="TableHead";const P=c.forwardRef(({className:t,...s},l)=>e.jsx("td",{ref:l,className:E("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...s}));P.displayName="TableCell";const ps=c.forwardRef(({className:t,...s},l)=>e.jsx("caption",{ref:l,className:E("mt-4 text-sm text-muted-foreground",t),...s}));ps.displayName="TableCaption";const Ns=({orders:t,selectedOrder:s,setSelectedOrder:l,handleDeleteOrder:u,isDeletingOrder:x,isMobile:b,formatDate:g})=>{var v;return e.jsxs(D,{children:[e.jsxs(L,{children:[e.jsx(V,{children:"Historial de Pedidos"}),e.jsx(J,{children:"Seguimiento de solicitudes recibidas"})]}),e.jsxs(I,{children:[b?e.jsx("div",{className:"space-y-3",children:t.map(a=>{var N;const p=((N=a.items)==null?void 0:N.reduce((w,i)=>w+i.quantity,0))||0;return e.jsxs("div",{className:"rounded-xl border border-border bg-card p-4 space-y-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:g(a.createdAt)})]}),e.jsx(K,{variant:a.status==="pending"?"secondary":"default",children:a.status==="pending"?"Pendiente":a.status})]}),e.jsxs("div",{className:"text-sm space-y-1.5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Sede:"})," ",e.jsx("span",{className:"font-medium text-foreground",children:a.branch})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Solicitante:"})," ",e.jsx("span",{className:"text-foreground text-xs",children:a.userEmail})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Total Items:"})," ",e.jsx("span",{className:"font-medium text-foreground",children:p})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border/50",children:[e.jsxs(m,{variant:"ghost",size:"sm",className:"h-9 px-3 gap-2 text-destructive hover:bg-destructive/10",onClick:()=>u(a.id),disabled:x===a.id,children:[e.jsx(F,{className:"h-4 w-4"}),x===a.id?"Eliminando...":"Eliminar"]}),e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>l(a),className:"h-9 px-3 gap-2",children:[e.jsx(ke,{className:"h-4 w-4"}),"Ver Detalles"]})]})]},a.id)})}):e.jsxs(ue,{children:[e.jsx(je,{children:e.jsxs(G,{children:[e.jsx(T,{children:"Fecha"}),e.jsx(T,{children:"Sede"}),e.jsx(T,{children:"Solicitante"}),e.jsx(T,{className:"text-center",children:"Total Items"}),e.jsx(T,{children:"Estado"}),e.jsx(T,{className:"text-right",children:"Acciones"})]})}),e.jsx(ge,{children:t.map(a=>{var N;const p=((N=a.items)==null?void 0:N.reduce((w,i)=>w+i.quantity,0))||0;return e.jsxs(G,{children:[e.jsxs(P,{className:"whitespace-nowrap flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4 text-muted-foreground"}),g(a.createdAt)]}),e.jsx(P,{children:a.branch}),e.jsx(P,{className:"text-muted-foreground text-sm",children:a.userEmail}),e.jsx(P,{className:"text-center font-medium",children:p}),e.jsx(P,{children:e.jsx(K,{variant:a.status==="pending"?"secondary":"default",children:a.status==="pending"?"Pendiente":a.status})}),e.jsx(P,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>l(a),children:e.jsx(ke,{className:"h-4 w-4"})}),e.jsx(m,{variant:"ghost",size:"icon",className:"text-destructive hover:bg-destructive/10",onClick:()=>u(a.id),disabled:x===a.id,children:e.jsx(F,{className:"h-4 w-4"})})]})})]},a.id)})})]}),t.length===0&&e.jsxs("div",{className:"text-center py-10 text-muted-foreground",children:[e.jsx(Be,{className:"h-10 w-10 mx-auto mb-2 opacity-20"}),e.jsx("p",{children:"No hay pedidos registrados"})]})]}),e.jsx(Pe,{open:!!s,onOpenChange:a=>!a&&l(null),children:e.jsxs(Ee,{className:"max-w-md",children:[e.jsxs(ze,{children:[e.jsx(Re,{children:"Detalle del Pedido"}),e.jsxs(J,{children:[s==null?void 0:s.branch," - ",g(s==null?void 0:s.createdAt)]})]}),e.jsxs("div",{className:"space-y-4 py-4 max-h-[60vh] overflow-y-auto",children:[e.jsxs("div",{className:"space-y-1 text-sm bg-muted/30 p-3 rounded-lg",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Solicitante:"})," ",s==null?void 0:s.userEmail]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"ID Pedido:"})," ",s==null?void 0:s.id.slice(0,8)]})]}),(s==null?void 0:s.note)&&e.jsxs("div",{className:"text-sm bg-yellow-50 dark:bg-yellow-950/30 border border-yellow-200 dark:border-yellow-800 p-3 rounded-lg",children:[e.jsxs("p",{className:"font-semibold flex items-center gap-2 mb-1",children:[e.jsx(qe,{className:"h-4 w-4"})," Nota"]}),e.jsx("p",{className:"text-muted-foreground",children:s.note})]}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(ue,{children:[e.jsx(je,{children:e.jsxs(G,{children:[e.jsx(T,{children:"Producto"}),e.jsx(T,{className:"text-right",children:"Cant."})]})}),e.jsx(ge,{children:(v=s==null?void 0:s.items)==null?void 0:v.map((a,p)=>e.jsxs(G,{children:[e.jsx(P,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:a.name}),a.code&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Ref: ",a.code]})]})}),e.jsx(P,{className:"text-right font-medium",children:a.quantity})]},p))})]})})]}),e.jsxs(Ae,{className:"sm:justify-between gap-2",children:[e.jsxs(m,{variant:"destructive",onClick:()=>s&&u(s.id),disabled:x===(s==null?void 0:s.id),children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),x===(s==null?void 0:s.id)?"Eliminando...":"Eliminar Pedido"]}),e.jsx(m,{variant:"outline",onClick:()=>l(null),children:"Cerrar"})]})]})})]})},fs=({products:t,categories:s,newProductName:l,setNewProductName:u,newProductCode:x,setNewProductCode:b,newProductCategory:g,setNewProductCategory:v,newCategoryName:a,setNewCategoryName:p,handleAddProduct:N,handleDeleteProduct:w,handleAddCategory:i,handleDeleteCategory:j,handleToggleVisibility:C,startEditing:z,editingProduct:R,setEditingProduct:$,editForm:S,setEditForm:A,saveEdit:U})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(D,{children:[e.jsxs(L,{children:[e.jsx(V,{children:"Categorías"}),e.jsx(J,{children:"Gestiona las categorías de productos"})]}),e.jsxs(I,{children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(q,{placeholder:"Nueva categoría...",value:a,onChange:r=>p(r.target.value)}),e.jsx(m,{size:"icon",onClick:i,children:e.jsx(Se,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2 max-h-[200px] overflow-y-auto",children:[s.map(r=>e.jsxs("div",{className:"flex justify-between items-center bg-muted/40 p-2 rounded-md",children:[e.jsx("span",{className:"text-sm",children:r.name}),e.jsx(m,{variant:"ghost",size:"icon",className:"h-6 w-6 text-destructive",onClick:()=>j(r.id),children:e.jsx(ss,{className:"h-3 w-3"})})]},r.id)),s.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"No hay categorías. Agrega una arriba."})]})]})]}),e.jsxs(D,{children:[e.jsxs(L,{children:[e.jsx(V,{children:"Nuevo Producto"}),e.jsx(J,{children:"Agrega un nuevo producto al catálogo"})]}),e.jsx(I,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(q,{value:l,onChange:r=>u(r.target.value),placeholder:"Nombre del producto..."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{value:x,onChange:r=>b(r.target.value),placeholder:"Código (opcional)",className:"w-1/3"}),e.jsxs(ce,{value:g,onValueChange:v,children:[e.jsx(oe,{className:"flex-1",children:e.jsx(de,{placeholder:"Categoría"})}),e.jsxs(me,{children:[e.jsx(M,{value:"General",children:"General"}),s.map(r=>e.jsx(M,{value:r.name,children:r.name},r.id))]})]})]}),e.jsxs(m,{onClick:N,className:"w-full",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"})," Agregar Producto"]})]})})]})]}),e.jsxs(D,{children:[e.jsx(L,{children:e.jsxs(V,{children:["Catálogo de Productos (",t.length,")"]})}),e.jsx(I,{children:e.jsx("div",{className:"space-y-2",children:t.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-2 w-2 rounded-full ${r.isVisible?"bg-green-500":"bg-gray-400 dark:bg-gray-500"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:r.name}),r.code&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Cód: ",r.code]})]}),e.jsx(K,{variant:"secondary",className:"text-xs",children:r.category})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>C(r),children:r.isVisible?"Ocultar":"Mostrar"}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>z(r),children:e.jsx(cs,{className:"h-4 w-4"})}),e.jsx(m,{variant:"ghost",size:"icon",className:"text-destructive hover:bg-destructive/10",onClick:()=>w(r.id),children:e.jsx(F,{className:"h-4 w-4"})})]})]},r.id))})})]}),e.jsx(Pe,{open:!!R,onOpenChange:r=>!r&&$(null),children:e.jsxs(Ee,{children:[e.jsx(ze,{children:e.jsx(Re,{children:"Editar Producto"})}),R&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Nombre"}),e.jsx(q,{value:S.name,onChange:r=>A({...S,name:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Código"}),e.jsx(q,{value:S.code,onChange:r=>A({...S,code:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Categoría"}),e.jsxs(ce,{value:S.category,onValueChange:r=>A({...S,category:r}),children:[e.jsx(oe,{children:e.jsx(de,{})}),e.jsxs(me,{children:[e.jsx(M,{value:"General",children:"General"}),s.map(r=>e.jsx(M,{value:r.name,children:r.name},r.id))]})]})]})]})]}),e.jsxs(Ae,{children:[e.jsx(m,{variant:"outline",onClick:()=>$(null),children:"Cancelar"}),e.jsx(m,{onClick:U,children:"Guardar Cambios"})]})]})})]}),As=()=>{const{user:t}=ye(),s=as(),[l,u]=c.useState([]),[x,b]=c.useState([]),[g,v]=c.useState([]),[a,p]=c.useState(""),[N,w]=c.useState("order"),[i,j]=c.useState(""),[C,z]=c.useState(""),[R,$]=c.useState(""),[S,A]=c.useState(""),[U,r]=c.useState("General"),[W,pe]=c.useState(""),[Y,O]=c.useState(null),[X,Ne]=c.useState({name:"",code:"",category:""}),[Ve,Ie]=c.useState([]),[Z,fe]=c.useState(null),[$e,be]=c.useState(!1),[He,ve]=c.useState(null),{isAdmin:_e}=ye(),H=_e;c.useEffect(()=>{const n=ee(B(y,"products"),se("name")),d=ae(n,f=>{const k=f.docs.map(o=>({id:o.id,...o.data()}));u(k)});return()=>d()},[]),c.useEffect(()=>{const n=ee(B(y,"product_categories"),se("name")),d=ae(n,f=>{const k=f.docs.map(o=>({id:o.id,...o.data()}));b(k)});return()=>d()},[]),c.useEffect(()=>{if(!H)return;const n=ee(B(y,"bookstore_requests"),se("createdAt","desc"),ts(50)),d=ae(n,f=>{const k=f.docs.map(o=>({id:o.id,...o.data()}));Ie(k)});return()=>d()},[H]);const Me=async()=>{if(W.trim())try{await te(B(y,"product_categories"),{name:W.trim(),createdAt:ie()}),pe(""),h.success("Categoría agregada")}catch{h.error("Error al agregar categoría")}},Ge=async n=>{if(confirm("¿Eliminar esta categoría?"))try{await re(_(y,"product_categories",n)),h.success("Categoría eliminada")}catch{h.error("Error al eliminar categoría")}},Fe=async()=>{if(R.trim())try{await te(B(y,"products"),{name:R.trim(),code:S.trim(),category:U,isVisible:!0,createdAt:ie()}),$(""),A(""),h.success("Producto agregado correctamente")}catch(n){console.error("Error adding product:",n),h.error("Error al agregar producto")}},Je=async n=>{if(confirm("¿Estás seguro de eliminar este producto?"))try{await re(_(y,"products",n)),h.success("Producto eliminado")}catch{h.error("Error al eliminar producto")}},Ue=async n=>{try{await we(_(y,"products",n.id),{isVisible:!n.isVisible})}catch{h.error("Error al actualizar estado")}},Xe=n=>{O(n),Ne({name:n.name,code:n.code||"",category:n.category||"General"})},Ze=async()=>{if(Y)try{await we(_(y,"products",Y.id),{name:X.name,code:X.code,category:X.category}),O(null),h.success("Producto actualizado")}catch{h.error("Error al actualizar producto")}},Ke=(n,d)=>{d<0||v(f=>{const k=f.find(o=>o.id===n.id);return d===0?f.filter(o=>o.id!==n.id):k?f.map(o=>o.id===n.id?{...o,quantity:d}:o):[...f,{...n,quantity:d}]})},Qe=async()=>{if(!a){h.error("Por favor selecciona una sede");return}if(g.length===0){h.error("El carrito está vacío");return}be(!0);try{const n={branch:a,userEmail:t==null?void 0:t.email,items:g.map(o=>({productId:o.id,name:o.name,code:o.code||"",quantity:o.quantity})),note:C.trim(),status:"pending",createdAt:ie()},d=await te(B(y,"bookstore_requests"),n),f=g.map(o=>`
        <tr>
          <td style="padding: 8px; border: 1px solid #ddd;">${o.name}${o.code?` <span style="color: #666; font-size: 12px;">(${o.code})</span>`:""}</td>
          <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">${o.quantity}</td>
        </tr>
      `).join(""),k=`
        <h3>Nueva Solicitud de Librería</h3>
        <p><b>Sede:</b> ${a}</p>
        <p><b>Solicitante:</b> ${t==null?void 0:t.email}</p>
        <p><b>Fecha:</b> ${new Date().toLocaleDateString()}</p>
        ${C.trim()?`<p><b>Nota:</b> ${C.trim()}</p>`:""}
        <br/>
        <table style="width: 100%; border-collapse: collapse; max-width: 600px;">
          <thead>
            <tr style="background-color: #f2f2f2;">
              <th style="padding: 8px; border: 1px solid #ddd; text-align: left;">Producto</th>
              <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">Cantidad</th>
            </tr>
          </thead>
          <tbody>
            ${f}
          </tbody>
        </table>
      `;await fetch("https://Operaciones.pythonanywhere.com/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recipient_email:"operaciones@bukz.co",userEmail:t==null?void 0:t.email,type_label:"Solicitud Librería",subject:`Solicitud Librería - ${a}`,email_body:k})}),h.success("Solicitud enviada exitosamente a Operaciones"),v([]),p(""),z("")}catch(n){console.error("Error submitting order:",n),h.error("Error al enviar la solicitud: "+n.message)}finally{be(!1)}},We=n=>{if(!n)return"-";const d=n.toDate();return d.toLocaleDateString()+" "+d.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},Ye=async n=>{if(confirm("¿Estás seguro de eliminar este pedido? Esta acción no se puede deshacer.")){ve(n);try{await re(_(y,"bookstore_requests",n)),(Z==null?void 0:Z.id)===n&&fe(null),h.success("Pedido eliminado correctamente")}catch(d){h.error("Error al eliminar el pedido: "+d.message)}finally{ve(null)}}};return e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-500",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-semibold text-foreground",children:"Solicitud de Librerías"}),e.jsx("p",{className:"mt-1 text-base text-muted-foreground",children:H?"Gestiona el catálogo de productos y categorías":"Realiza solicitudes de insumos y productos para tu sede"})]}),e.jsxs(rs,{value:N,onValueChange:w,className:"w-full",children:[e.jsxs(ns,{className:"bg-muted/50 p-1 mb-6",children:[e.jsxs(ne,{value:"order",className:"gap-2",children:[e.jsx(is,{className:"h-4 w-4"}),"Nuevo Pedido"]}),H&&e.jsxs(e.Fragment,{children:[e.jsxs(ne,{value:"history",className:"gap-2",children:[e.jsx(Be,{className:"h-4 w-4"}),"Historial de Pedidos"]}),e.jsxs(ne,{value:"products",className:"gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),"Productos y Categorías"]})]})]}),e.jsx(le,{value:"order",className:"mt-0",children:e.jsx(js,{products:l,cart:g,selectedBranch:a,setSelectedBranch:p,searchQuery:i,setSearchQuery:j,orderNote:C,setOrderNote:z,updateCart:Ke,handleSubmitOrder:Qe,isSubmitting:$e,branches:ms})}),H&&e.jsxs(e.Fragment,{children:[e.jsx(le,{value:"history",className:"mt-0",children:e.jsx(Ns,{orders:Ve,selectedOrder:Z,setSelectedOrder:fe,handleDeleteOrder:Ye,isDeletingOrder:He,isMobile:s,formatDate:We})}),e.jsx(le,{value:"products",className:"mt-0",children:e.jsx(fs,{products:l,categories:x,newProductName:R,setNewProductName:$,newProductCode:S,setNewProductCode:A,newProductCategory:U,setNewProductCategory:r,newCategoryName:W,setNewCategoryName:pe,handleAddProduct:Fe,handleDeleteProduct:Je,handleAddCategory:Me,handleDeleteCategory:Ge,handleToggleVisibility:Ue,startEditing:Xe,editingProduct:Y,setEditingProduct:O,editForm:X,setEditForm:Ne,saveEdit:Ze})})]})]})]})};export{As as default};
