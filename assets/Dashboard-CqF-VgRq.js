import{u as P,a as F,r as m,q as u,w as o,c as p,o as h,L as H,C as J,B as K,b as B,j as e,d as W,e as f}from"./index-zZ0VZZ4p.js";import{A as k}from"./arrow-right-Z0ei38Y4.js";import{C,f as X}from"./format-Cu5othT5.js";import{U as M,e as Y}from"./es-BuEom4ST.js";const Z={Baja:"bg-muted text-muted-foreground border-border",Media:"bg-info/15 text-info border-info/20",Alta:"bg-warning/15 text-amber-700 dark:text-warning border-warning/20",Urgente:"bg-destructive/15 text-destructive border-destructive/20"},re=()=>{const g=P(),{user:c}=F(),[b,q]=m.useState([]),[v,D]=m.useState([]),[j,N]=m.useState({tasks:0,requests:0,operations:0}),[A,S]=m.useState(!0);m.useEffect(()=>{if(!c)return;const s=new Map,w=u(p(f,"user_tasks"),o("userId","==",c.uid),o("status","==","todo")),z=u(p(f,"user_tasks"),o("assignedTo","==",c.email),o("status","==","todo")),T=()=>{const r=Array.from(s.values()),a=[...r].sort((t,i)=>{var d,l,n,x;const y=((l=(d=t.createdAt)==null?void 0:d.toMillis)==null?void 0:l.call(d))||0;return(((x=(n=i.createdAt)==null?void 0:n.toMillis)==null?void 0:x.call(n))||0)-y});q(a.slice(0,5)),N(t=>({...t,tasks:r.length})),S(!1)},L=h(w,r=>{r.docs.forEach(t=>{s.set(t.id,{id:t.id,...t.data()})});const a=new Set(r.docs.map(t=>t.id));s.forEach((t,i)=>{!t.assignedTo&&!a.has(i)&&s.delete(i)}),T()}),O=h(z,r=>{const a=new Set(r.docs.map(t=>t.id));s.forEach((t,i)=>{t.assignedTo===c.email&&!a.has(i)&&s.delete(i)}),r.docs.forEach(t=>{s.set(t.id,{id:t.id,...t.data()})}),T()}),Q=u(p(f,"leave_requests"),o("userId","==",c.uid)),I=h(Q,r=>{N(a=>({...a,requests:r.size}))}),_=u(p(f,"tasks"),o("status","!=","done")),G=h(_,r=>{N(a=>({...a,operations:r.size}))}),R=u(p(f,"tasks"),o("department","==","Devolución")),U=h(R,r=>{const a=r.docs.map(t=>({id:t.id,...t.data()})).filter(t=>t.status!=="done").sort((t,i)=>{var d,l,n,x;const y=((l=(d=t.createdAt)==null?void 0:d.toMillis)==null?void 0:l.call(d))||0;return(((x=(n=i.createdAt)==null?void 0:n.toMillis)==null?void 0:x.call(n))||0)-y});D(a)});return()=>{L(),O(),I(),G(),U()}},[c]);const E=[{title:"Operaciones",description:"Gestionar tareas entre departamentos",icon:H,path:"/operations",count:j.operations,label:"tareas"},{title:"Tareas",description:"Gestor de tareas personal",icon:J,path:"/tasks",count:j.tasks,label:"pendientes"},{title:"Guías",description:"Base de conocimiento",icon:K,path:"/instructions",count:5,label:"guías"},{title:"Solicitudes",description:"Permisos y vacaciones",icon:B,path:"/requests",count:j.requests,label:"solicitudes"}];return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-semibold text-foreground",children:"Bienvenido"}),e.jsx("p",{className:"mt-1 text-base text-muted-foreground",children:"Esto es lo que está pasando en tu organización."})]}),e.jsx("div",{className:"grid gap-3 md:gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4",children:E.map(s=>e.jsxs("button",{onClick:()=>g(s.path),className:"group flex flex-col justify-between rounded-xl border border-border bg-card p-5 text-left transition-all hover:border-primary/40 hover:shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(s.icon,{className:"h-6 w-6 text-foreground"}),e.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:[s.count," ",s.label]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-base font-medium text-foreground",children:s.title}),e.jsx("p",{className:"mt-0.5 text-sm text-muted-foreground",children:s.description})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-1 text-xs font-medium text-muted-foreground group-hover:text-foreground transition-theme",children:["Abrir ",e.jsx(k,{className:"h-3 w-3"})]})]},s.path))}),e.jsxs("div",{className:"grid gap-4 md:gap-6 grid-cols-1 lg:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4",children:"Mis Tareas Activas"}),e.jsxs("div",{className:"rounded-xl border border-border bg-card divide-y divide-border overflow-hidden",children:[A?e.jsx("div",{className:"divide-y divide-border",children:Array.from({length:3}).map((s,w)=>e.jsxs("div",{className:"flex items-center gap-3 px-5 py-3.5",children:[e.jsx("div",{className:"h-2.5 w-2.5 rounded-full bg-muted animate-pulse"}),e.jsx("div",{className:"flex-1 space-y-2",children:e.jsx("div",{className:"h-4 w-3/4 rounded bg-muted animate-pulse"})}),e.jsx("div",{className:"h-5 w-14 rounded-full bg-muted animate-pulse"})]},w))}):b.length===0?e.jsx("div",{className:"px-5 py-8 text-center text-sm text-muted-foreground",children:"No tienes tareas pendientes. ¡Buen trabajo!"}):b.map(s=>e.jsxs("div",{className:"flex items-center justify-between px-5 py-3.5 transition-theme hover:bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden flex-1",children:[e.jsx(C,{className:"h-2.5 w-2.5 text-muted-foreground flex-none"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-medium text-foreground truncate block",children:s.title}),s.assignedBy&&e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs text-muted-foreground",children:[e.jsx(M,{className:"h-2.5 w-2.5"}),e.jsxs("span",{className:"truncate",children:["Asignada por ",s.assignedBy.split("@")[0]]})]})]})]}),e.jsx("div",{className:"flex items-center gap-4 flex-none",children:e.jsx("span",{className:W("text-xs uppercase tracking-wider font-bold px-2 py-0.5 rounded-full border",Z[s.priority]||"bg-muted text-muted-foreground"),children:s.priority})})]},s.id)),!A&&b.length>0&&e.jsxs("button",{onClick:()=>g("/tasks"),className:"w-full py-3 px-5 text-xs font-semibold text-zinc-800 dark:text-zinc-200 hover:bg-muted/50 border-t border-border transition-colors flex items-center justify-center gap-2",children:["Ver todas las tareas ",e.jsx(k,{className:"h-3 w-3"})]})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4",children:"Devoluciones Activas"}),e.jsxs("div",{className:"rounded-xl border border-border bg-card divide-y divide-border overflow-hidden",children:[v.length===0?e.jsx("div",{className:"px-5 py-8 text-center text-sm text-muted-foreground italic",children:"No hay devoluciones activas."}):v.map(s=>e.jsx("div",{className:"flex items-center px-5 py-3.5 transition-theme hover:bg-muted/50",children:e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden flex-1",children:[e.jsx(C,{className:"h-2.5 w-2.5 text-muted-foreground flex-none"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-medium text-foreground truncate block",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.createdBy&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(M,{className:"h-2.5 w-2.5"}),e.jsx("span",{children:s.createdBy.split("@")[0]})]}),s.dueDate&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground bg-muted px-1.5 py-0.5 rounded border border-border",children:[e.jsx(B,{className:"h-2.5 w-2.5"}),e.jsxs("span",{children:["Límite: ",X(new Date(s.dueDate+"T00:00:00"),"dd MMM",{locale:Y})]})]})]})]})]})},s.id)),v.length>0&&e.jsxs("button",{onClick:()=>g("/operations"),className:"w-full py-3 px-5 text-xs font-semibold text-zinc-800 dark:text-zinc-200 hover:bg-muted/50 border-t border-border transition-colors flex items-center justify-center gap-2",children:["Ver en Operaciones ",e.jsx(k,{className:"h-3 w-3"})]})]})]})]})]})};export{re as default};
