import{v as S,E as oe,r as o,H as Q,Y as ce,j as e,P as V,J as le,aj as de,d as C,a as me,u as ue,o as X,c as $,ak as pe,I as he,g as I,al as xe,L as fe,C as ge,B as be,b as ve,a9 as ye,t as je,n as B,e as L,i as g,am as F}from"./index-zZ0VZZ4p.js";import{u as Ne}from"./index-DPxdIXPI.js";import{B as T}from"./badge-CucsVBSM.js";import{C as J,a as K,b as ke,c as we,d as W}from"./card-OND3B57R.js";import{P as Ce,T as Se}from"./trash-2-BdXGZdJo.js";import{C as Ee}from"./clock-zgQVrAEz.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=S("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=S("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=S("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=S("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=S("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=S("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);var D="Switch",[De,$e]=oe(D),[Re,Ie]=De(D),Z=o.forwardRef((t,d)=>{const{__scopeSwitch:c,name:m,checked:l,defaultChecked:b,required:u,disabled:f,value:p="on",onCheckedChange:E,form:h,...j}=t,[v,x]=o.useState(null),P=Q(d,w=>x(w)),_=o.useRef(!1),M=v?h||!!v.closest("form"):!0,[N,k]=ce({prop:l,defaultProp:b??!1,onChange:E,caller:D});return e.jsxs(Re,{scope:c,checked:N,disabled:f,children:[e.jsx(V.button,{type:"button",role:"switch","aria-checked":N,"aria-required":u,"data-state":te(N),"data-disabled":f?"":void 0,disabled:f,value:p,...j,ref:P,onClick:le(t.onClick,w=>{k(R=>!R),M&&(_.current=w.isPropagationStopped(),_.current||w.stopPropagation())})}),M&&e.jsx(ae,{control:v,bubbles:!_.current,name:m,value:p,checked:N,required:u,disabled:f,form:h,style:{transform:"translateX(-100%)"}})]})});Z.displayName=D;var ee="SwitchThumb",se=o.forwardRef((t,d)=>{const{__scopeSwitch:c,...m}=t,l=Ie(ee,c);return e.jsx(V.span,{"data-state":te(l.checked),"data-disabled":l.disabled?"":void 0,...m,ref:d})});se.displayName=ee;var Be="SwitchBubbleInput",ae=o.forwardRef(({__scopeSwitch:t,control:d,checked:c,bubbles:m=!0,...l},b)=>{const u=o.useRef(null),f=Q(u,b),p=Ne(c),E=de(d);return o.useEffect(()=>{const h=u.current;if(!h)return;const j=window.HTMLInputElement.prototype,x=Object.getOwnPropertyDescriptor(j,"checked").set;if(p!==c&&x){const P=new Event("click",{bubbles:m});x.call(h,c),h.dispatchEvent(P)}},[p,c,m]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:c,...l,tabIndex:-1,ref:f,style:{...l.style,...E,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ae.displayName=Be;function te(t){return t?"checked":"unchecked"}var re=Z,Te=se;const z=o.forwardRef(({className:t,...d},c)=>e.jsx(re,{className:C("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-all duration-200 ease-out data-[state=checked]:bg-primary data-[state=unchecked]:bg-input hover:opacity-90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",t),...d,ref:c,children:e.jsx(Te,{className:C("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-all duration-300 ease-spring data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));z.displayName=re.displayName;const H=[{path:"/dashboard",label:"Dashboard",description:"Página principal",icon:xe},{path:"/operations",label:"Operaciones",description:"Tablero de tareas entre áreas",icon:fe},{path:"/tasks",label:"Tareas",description:"Gestor de tareas personales",icon:ge},{path:"/instructions",label:"Guías",description:"Base de conocimiento",icon:be},{path:"/requests",label:"Solicitudes",description:"Permisos y vacaciones",icon:ve},{path:"/bookstore-requests",label:"Solicitud Librerías",description:"Pedidos para librerías",icon:ye}],U=()=>Object.fromEntries(H.map(t=>[t.path,!0]));function ze(t){return t!=null&&t.seconds?new Date(t.seconds*1e3).toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}):"Nunca"}function Fe(){const{user:t,isAdmin:d,roleLoading:c}=me(),m=ue(),[l,b]=o.useState(U()),[u,f]=o.useState([]),[p,E]=o.useState([]),[h,j]=o.useState(""),[v,x]=o.useState(null),[P,_]=o.useState(null);o.useEffect(()=>{t&&!c&&!d&&m("/dashboard")},[t,c,d,m]),o.useEffect(()=>{const s=X($(L,"navigation_permissions"),a=>{const r=[];let n=!1;a.forEach(i=>{const y=i.data();i.id==="_default"?(n=!0,b({...U(),...y.pages??{}})):r.push({email:i.id,pages:{...U(),...y.pages??{}}})}),n||b(U()),f(r)});return()=>s()},[]),o.useEffect(()=>{const s=X($(L,"users"),a=>{const r=[];a.forEach(n=>{const i=n.data();r.push({email:n.id,displayName:i.displayName||n.id.split("@")[0],lastLogin:i.lastLogin??null})}),E(r.filter(n=>n.email!==(t==null?void 0:t.email)).sort((n,i)=>n.email.localeCompare(i.email)))});return()=>s()},[]);const M=p.map(s=>{const a=u.find(r=>r.email===s.email);return{...s,pages:(a==null?void 0:a.pages)??null,hasCustomConfig:!!a}}),N=u.filter(s=>!p.find(a=>a.email===s.email)).map(s=>({email:s.email,displayName:s.email.split("@")[0],lastLogin:null,pages:s.pages,hasCustomConfig:!0})),k=[...M,...N].sort((s,a)=>s.email.localeCompare(a.email)),w=async s=>{x("_default");try{await F(B(L,"navigation_permissions","_default"),{pages:s}),g.success("Configuración por defecto guardada")}catch{g.error("Error al guardar")}finally{x(null)}},R=async(s,a)=>{const r={...l,[s]:a};b(r),await w(r)},q=async(s,a)=>{x(s);try{await F(B(L,"navigation_permissions",s),{pages:a}),g.success(`Permisos de ${s} guardados`)}catch{g.error("Error al guardar")}finally{x(null)}},ne=async(s,a,r,n)=>{const y={...n??l,[a]:r};await q(s,y)},A=async s=>{try{await je(B(L,"navigation_permissions",s)),g.success(`${s} ahora usa la configuración por defecto`)}catch{g.error("Error al restablecer")}},O=async()=>{const s=h.trim().toLowerCase();if(!s||!s.includes("@")){g.error("Ingresa un correo electrónico válido");return}if(u.find(a=>a.email===s)){g.error("Este usuario ya tiene configuración específica");return}await q(s,{...l}),j("")};return!t||c||!d?null:e.jsxs("div",{className:"max-w-3xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-primary/10 flex items-center justify-center shrink-0 mt-0.5",children:e.jsx(Le,{className:"h-5 w-5 text-black dark:text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Permisos de Navegación"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Controla qué páginas puede ver cada usuario en la plataforma."})]})]}),e.jsxs("div",{className:"flex items-start gap-3 rounded-lg border border-blue-200 bg-blue-50 dark:border-blue-900 dark:bg-blue-950/30 px-4 py-3",children:[e.jsx(Pe,{className:"h-4 w-4 text-blue-500 shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-400 leading-relaxed",children:["Los cambios aplican de forma inmediata. Si un usuario tiene configuración ",e.jsx("strong",{children:"personalizada"}),", tiene prioridad sobre la predeterminada. Los usuarios aparecen automáticamente al iniciar sesión por primera vez."]})]}),e.jsxs(J,{children:[e.jsxs(K,{className:"pb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4 text-black dark:text-primary"}),e.jsx(ke,{className:"text-base",children:"Configuración por defecto"})]}),e.jsx(we,{children:"Aplica a todos los usuarios sin configuración personalizada"})]}),e.jsx(W,{children:e.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:H.map(s=>{const a=l[s.path]??!0,r=v==="_default";return e.jsxs("div",{className:C("flex items-center justify-between gap-3 rounded-lg border p-3 transition-all duration-200",a?"border-border bg-card":"border-dashed border-border/50 bg-muted/20 opacity-60"),children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"h-8 w-8 rounded-md bg-muted flex items-center justify-center shrink-0",children:e.jsx(s.icon,{className:"h-3.5 w-3.5 text-muted-foreground"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium leading-none mb-0.5",children:s.label}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[r&&e.jsx(Y,{className:"h-3 w-3 text-muted-foreground animate-spin"}),e.jsx(z,{checked:a,onCheckedChange:n=>R(s.path,n),className:C(r&&"pointer-events-none opacity-70")})]})]},s.path)})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h2",{className:"text-base font-semibold",children:"Usuarios"}),k.length>0&&e.jsx(T,{variant:"secondary",className:"text-xs h-5",children:k.length})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(he,{placeholder:"correo@bukz.co (si aún no ha iniciado sesión)",value:h,onChange:s=>j(s.target.value),onKeyDown:s=>s.key==="Enter"&&O(),className:"text-sm"}),e.jsxs(I,{onClick:O,size:"sm",className:"gap-1.5 shrink-0",children:[e.jsx(Ce,{className:"h-3.5 w-3.5"}),"Agregar"]})]}),k.length===0&&e.jsxs("div",{className:"rounded-lg border border-dashed p-10 text-center",children:[e.jsx(Me,{className:"h-8 w-8 text-muted-foreground/30 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ningún usuario ha iniciado sesión aún."}),e.jsx("p",{className:"text-xs text-muted-foreground/70 mt-1",children:"Los usuarios aparecen aquí automáticamente al ingresar a la plataforma."})]}),e.jsx("div",{className:"grid gap-3",children:k.map(s=>{const a=P===s.email,r=s.pages??l,n=Object.values(r).filter(Boolean).length;return e.jsxs(J,{className:"overflow-hidden",children:[e.jsx("button",{className:"w-full text-left",onClick:()=>_(a?null:s.email),children:e.jsx(K,{className:"py-3 px-4 bg-muted/20 hover:bg-muted/40 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2.5 min-w-0",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx("span",{className:"text-xs font-bold text-primary",children:s.displayName[0].toUpperCase()})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate leading-none mb-0.5",children:s.email}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.hasCustomConfig?e.jsxs(T,{className:"text-[10px] h-4 px-1.5 bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400 border-amber-200 dark:border-amber-800",children:["Personalizado · ",n," páginas"]}):e.jsxs(T,{variant:"outline",className:"text-[10px] h-4 px-1.5 text-muted-foreground",children:["Default · ",n," páginas"]}),s.lastLogin&&e.jsxs("span",{className:"text-[10px] text-muted-foreground flex items-center gap-1",children:[e.jsx(Ee,{className:"h-2.5 w-2.5"}),ze(s.lastLogin)]})]})]})]}),e.jsx("span",{className:"text-xs text-muted-foreground shrink-0",children:a?"▲":"▼"})]})})}),a&&e.jsxs(W,{className:"p-3 border-t",children:[e.jsx("div",{className:"grid gap-1.5 sm:grid-cols-2 mb-3",children:H.map(i=>{const y=r[i.path]??!0,G=v===s.email;return e.jsxs("div",{className:C("flex items-center justify-between gap-3 rounded-md px-3 py-2 transition-all duration-200",y?"bg-muted/30":"opacity-50"),children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(i.icon,{className:"h-3.5 w-3.5 text-muted-foreground shrink-0"}),e.jsx("span",{className:"text-xs font-medium truncate",children:i.label}),!s.hasCustomConfig&&e.jsx("span",{className:"text-[10px] text-muted-foreground/60 hidden sm:inline",children:"(default)"})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[G&&e.jsx(Y,{className:"h-3 w-3 text-muted-foreground animate-spin"}),e.jsx(z,{checked:y,onCheckedChange:ie=>ne(s.email,i.path,ie,s.pages),className:C(G&&"pointer-events-none opacity-70")})]})]},i.path)})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-1 border-t",children:[s.hasCustomConfig&&e.jsxs(I,{variant:"ghost",size:"sm",className:"h-7 text-xs gap-1.5 text-muted-foreground hover:text-foreground",onClick:()=>A(s.email),children:[e.jsx(_e,{className:"h-3 w-3"}),"Restablecer a default"]}),!p.find(i=>i.email===s.email)&&e.jsxs(I,{variant:"ghost",size:"sm",className:"h-7 text-xs gap-1.5 text-muted-foreground hover:text-destructive hover:bg-destructive/10",onClick:()=>A(s.email),children:[e.jsx(Se,{className:"h-3 w-3"}),"Eliminar"]})]})]})]},s.email)})})]})]})}export{Fe as default};
